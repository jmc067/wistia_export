$(function(){var g="825ab49ccbff4ab140e524cbb15918a285bf98e4b1ab44e6617a0574c1d0052a";var d=false;function f(i){}function b(i){$("#status").html(i+"...")}function e(l){var o="";var j="";for(var n in l[0]){var m=l[0];if(j!=""){j+=","}j+=n}o+=j+"\r\n";for(var k=0;k<l.length;k++){var j="";for(var n in l[k]){var m=l[k];if(j!=""){j+=","}j+=m[n]}o+=j+"\r\n"}return o}function c(i){var j="events_export.csv";a=document.createElement("a");a.textContent="download";a.download=j;a.href="data:text/csv;charset=utf-8,"+escape(i);document.getElementById("action_buttons").appendChild(a)}function h(i,j){b("Retrieving Selected Dates");f(i+" -> "+j);b("Triggered Export");jQuery.ajax({url:"https://api.wistia.com/v1/medias.json?api_password="+g,success:function(n){f("Downloaded Medias");var l={};for(var k=0;k<n.length;k++){var m=n[k];l[m.hashed_id]=m}f(l);jQuery.ajax({url:"https://api.wistia.com/v1/stats/visitors.json?api_password="+g,success:function(r){b("Downloaded Visitors");var p={};for(var o=0;o<r.length;o++){var q=r[o];p[q.visitor_key]=q}f(p);jQuery.ajax({data:{start_date:i,end_date:j},url:"https://api.wistia.com/v1/stats/events.json?api_password="+g,success:function(x){b("Downloaded Events");var v=[];for(var u=0;u<x.length;u++){var s=x[u];var t=x[u]["visitor_key"];var w=p[t];v.push({received_at:s.received_at,ip:s.ip,country:s.country,region:s.region,city:s.city,lat:s.lat,lon:s.lon,percent_viewed:s.percent_viewed,embed_url:s.embed_url,visitor_name:w.visitor_identity["name"],visitor_email:w.visitor_identity["email"],org_name:w.visitor_identity["org"]["name"],org_title:w.visitor_identity["org"]["title"],browser:w.user_agent_details["browser"],browser_version:w.user_agent_details["browser_version"],platform:w.user_agent_details["platform"],mobile:w.user_agent_details["mobile"]});b("Formatted Events")}f(v);b("Converting Events To CSV");csv=e(v);f(csv);b("Ready For Download");var y=i+"->"+j+"_events_export_download";c(csv,y)}}).fail(function(){b("Export Failed: Error Retrieving Events")})}}).fail(function(){b("Export Failed: Error Retrieving Visitors")})}}).fail(function(){b("Export Failed: Error Retrieving Medias")})}$("#daterangepicker").daterangepicker({autoUpdateInput:false,locale:{cancelLabel:"Clear"}});$("#daterangepicker").on("apply.daterangepicker",function(k,j){var i=j.startDate.format("YYYY-MM-DD");var l=j.endDate.format("YYYY-MM-DD");h(i,l)});$("#daterangepicker").on("cancel.daterangepicker",function(j,i){$(this).val("")})});